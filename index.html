<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feature Duelists HP Tracker</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
  .container { max-width: 400px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  input, select, button { width: 100%; padding: 10px; margin: 5px 0; font-size: 1rem; border-radius: 5px; border: 1px solid #ccc; }
  .hp-bar { width: 100%; background: #ddd; border-radius: 5px; overflow: hidden; margin-top: 10px; }
  .hp-fill { height: 25px; background: #4caf50; width: 100%; text-align: center; color: #fff; line-height: 25px; font-weight: bold; transition: background-color 0.3s, box-shadow 0.3s; }
  .undo-btn { background-color: #f44336; color: white; }
  .quick-buttons { display: flex; justify-content: space-between; margin: 5px 0; }
  .quick-buttons button { flex: 1; margin: 0 2px; font-size: 0.8rem; }

  @keyframes heartbeat {
    0% { box-shadow: 0 0 10px 0 rgba(0,0,255,0.5); }
    50% { box-shadow: 0 0 20px 5px rgba(0,0,255,0.7); }
    100% { box-shadow: 0 0 10px 0 rgba(0,0,255,0.5); }
  }
  .heartbeat {
    animation: heartbeat 1s infinite;
  }
</style>
</head>
<body>
<div class="container">
  <h2>Feature Duelists HP Tracker</h2>
  <label>Current HP:</label>
  <input type="number" id="currentHP" value="2000" min="0" max="2000">

  <label>Modifier:</label>
  <select id="modifier">
    <option value="heal">+25% Healing</option>
    <option value="0.2">+20% Increased Damage</option>
    <option value="0.5">+50% Increased Damage</option>
    <option value="normal">Normal HP Damage</option>
  </select>

  <div class="quick-buttons">
    <button onclick="applyQuickModifier(100)">100 HP</button>
    <button onclick="applyQuickModifier(200)">200 HP</button>
    <button onclick="applyQuickModifier(300)">300 HP</button>
    <button onclick="applyQuickModifier(400)">400 HP</button>
    <button onclick="applyQuickModifier(500)">500 HP</button>
  </div>

  <button onclick="applyDamageModifier(2000)">Apply Modifier</button>
  <button onclick="confusingParagraph()">Confusing Paragraph Opponent Effect: Heads/Tails - 50% Chance of Success/Failure for Opponent</button>
  <button class="undo-btn" onclick="undoDamage()">Undo</button>
  <button style="background-color: purple; color: white;" onclick="instantKO()">Ultima Cards Used By Opponent - Instant KO!</button>

  <div class="hp-bar">
    <div class="hp-fill" id="hpFill">2000 HP</div>
  </div>
</div>

<script>
let hpHistory = [2000]; // Stack to keep track of previous HP values
let dangerTriggered = false;
const totalHP = 2000;

function roundTo5(num) {
    return Math.round(num / 5) * 5;
}

function flashBar(color) {
    const hpFill = document.getElementById('hpFill');
    const originalColor = '#4caf50';
    hpFill.style.backgroundColor = color;
    setTimeout(() => { hpFill.style.backgroundColor = originalColor; }, 300);
}

function applyDamageModifier(baseValue) {
    const currentHPInput = document.getElementById('currentHP');
    const mod = document.getElementById('modifier').value;

    let currentHP = parseFloat(currentHPInput.value);
    hpHistory.push(currentHP); // Save current HP before applying change

    let newHP = currentHP;

    if (mod === 'heal') {
        newHP = currentHP + roundTo5(0.25 * totalHP);
        if (newHP > totalHP) newHP = totalHP;
        flashBar('yellow'); // Flash yellow for healing
    } else if (mod === 'normal') {
        newHP = currentHP - roundTo5(baseValue);
        if (newHP < 0) newHP = 0;
        flashBar('red'); // Flash red for damage
    } else {
        newHP = currentHP - roundTo5(baseValue + baseValue * parseFloat(mod));
        if (newHP < 0) newHP = 0;
        flashBar('red'); // Flash red for damage
    }

    currentHPInput.value = newHP;
    updateBar(newHP);
    checkWarnings(newHP);
}

function applyQuickModifier(baseValue) {
    applyDamageModifier(baseValue);
}

function undoDamage() {
    const currentHPInput = document.getElementById('currentHP');
    if (hpHistory.length > 1) {
        hpHistory.pop(); // Remove current HP
        const lastHP = hpHistory[hpHistory.length - 1];
        currentHPInput.value = lastHP;
        updateBar(lastHP);
        checkWarnings(lastHP);
    } else {
        alert('Nothing to undo!');
    }
}

function updateBar(hp) {
    const hpFill = document.getElementById('hpFill');
    const percent = (hp / totalHP) * 100;
    hpFill.style.width = percent + '%';
    hpFill.textContent = hp + ' HP';

    if(hp <= 500){
        hpFill.classList.add('heartbeat');
        hpFill.style.backgroundColor = 'blue';
    } else {
        hpFill.classList.remove('heartbeat');
        hpFill.style.backgroundColor = '#4caf50';
    }
}

function checkWarnings(hp) {
    if (hp <= 0) {
        alert('Game Over!');
        dangerTriggered = false;
    } else if (hp <= 500 && !dangerTriggered) {
        alert('Danger!');
        dangerTriggered = true;
    }
}

function confusingParagraph() {
    const outcome = Math.random() < 0.5 ? 'heads' : 'tails';
    if (outcome === 'heads') {
        alert("Oh no! You've taken damage despite your opponent using the Confusing Paragraph Spell Card! Please manually adjust your health to match the Feature Monster's attack number that your opponent used. For example: If they used a Short Sentence Imp, 100 damage would be inflicted to the total player health.");
    } else {
        alert("You're very lucky! You HAVEN'T taken damage upon your opponent using the Confusing Paragraph Spell Card. You may proceed with your turn after your opponent has finished their turn with this card, or if they've played the spell card alongside a Feature Monster card.");
    }
}

function instantKO() {
    const currentHPInput = document.getElementById('currentHP');
    hpHistory.push(parseFloat(currentHPInput.value));
    currentHPInput.value = 0;
    updateBar(0);
    alert('Game Over!');
}
</script>
</body>
</html>
